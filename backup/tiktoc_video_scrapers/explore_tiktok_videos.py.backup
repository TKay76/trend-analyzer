#!/usr/bin/env python3
"""
TikTok Creative Center - Video ì„¹ì…˜ íƒìƒ‰ ìŠ¤í¬ë¦½íŠ¸
https://ads.tiktok.com/business/creativecenter/inspiration/popular/pc/en ì—ì„œ
ìƒìœ„ 30ê°œ ë¹„ë””ì˜¤ì˜ ì£¼ì†Œ, ì¸ë„¤ì¼, í•´ì‹œíƒœê·¸ ìˆ˜ì§‘ ê°€ëŠ¥ì„± íƒìƒ‰
"""

import time
from playwright.sync_api import sync_playwright
from bs4 import BeautifulSoup
import json
import sys
import os

def explore_tiktok_videos():
    """
    TikTok Creative Centerì˜ Video ì„¹ì…˜ì„ íƒìƒ‰í•˜ì—¬ ë°ì´í„° êµ¬ì¡° ë¶„ì„
    """
    target_url = "https://ads.tiktok.com/business/creativecenter/inspiration/popular/pc/en"
    
    print("TikTok Creative Center Video ì„¹ì…˜ íƒìƒ‰ ì‹œì‘...")
    print(f"URL: {target_url}")
    
    with sync_playwright() as p:
        browser = p.chromium.launch(headless=False)  # headless=Falseë¡œ ë¸Œë¼ìš°ì € ì°½ì„ ë³´ë©´ì„œ íƒìƒ‰
        page = browser.new_page()
        
        try:
            print("\ní˜ì´ì§€ ë¡œë”© ì¤‘...")
            page.goto(target_url, wait_until="networkidle")
            page.wait_for_timeout(5000)  # í˜ì´ì§€ ë¡œë”© ëŒ€ê¸°
            
            print("í˜ì´ì§€ ë¡œë”© ì™„ë£Œ")
            
            # í˜ì´ì§€ ìŠ¤í¬ë¡¤í•˜ì—¬ ëª¨ë“  ì½˜í…ì¸  ë¡œë“œ
            print("\ní˜ì´ì§€ ìŠ¤í¬ë¡¤ ì¤‘...")
            page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
            page.wait_for_timeout(3000)
            
            # Video íƒ­ì´ ìˆëŠ”ì§€ í™•ì¸
            print("\nVideo íƒ­ ì°¾ëŠ” ì¤‘...")
            
            # ê°€ëŠ¥í•œ Video íƒ­ ì…€ë ‰í„°ë“¤
            video_tab_selectors = [
                "span.ContentTab_itemLabelText__hiCCd:has-text('Video')",
                "span:has-text('Video')",
                "[data-testid*='video']",
                "button:has-text('Video')",
                "a:has-text('Video')"
            ]
            
            video_tab_found = False
            for selector in video_tab_selectors:
                try:
                    video_tab = page.query_selector(selector)
                    if video_tab and video_tab.is_visible():
                        print(f"âœ… Video íƒ­ ë°œê²¬: {selector}")
                        print(f"   í…ìŠ¤íŠ¸: {video_tab.inner_text()}")
                        video_tab.click()
                        video_tab_found = True
                        page.wait_for_timeout(3000)
                        break
                except Exception as e:
                    continue
            
            if not video_tab_found:
                print("âŒ Video íƒ­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ êµ¬ì¡°ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤...")
                
                # í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  íƒ­ê³¼ ì„¹ì…˜ ë¶„ì„
                html_content = page.content()
                soup = BeautifulSoup(html_content, 'html.parser')
                
                # ëª¨ë“  íƒ­ ì°¾ê¸°
                print("\nğŸ“‹ í˜ì´ì§€ì—ì„œ ë°œê²¬ëœ íƒ­ë“¤:")
                tabs = soup.select("span.ContentTab_itemLabelText__hiCCd")
                if tabs:
                    for i, tab in enumerate(tabs):
                        print(f"   {i+1}. {tab.get_text().strip()}")
                else:
                    # ë‹¤ë¥¸ íƒ­ êµ¬ì¡° ì°¾ê¸°
                    possible_tabs = soup.select("span:contains('Music'), span:contains('Video'), span:contains('Creator')")
                    print("   ëŒ€ì²´ íƒ­ êµ¬ì¡°:")
                    for tab in possible_tabs[:5]:
                        print(f"   - {tab.get_text().strip()}")
            
            # Music íƒ­ì—ì„œ ì‹œì‘í•˜ì—¬ ë‹¤ë¥¸ ì„¹ì…˜ë“¤ íƒìƒ‰
            print("\nğŸµ í˜„ì¬ Music ì„¹ì…˜ì—ì„œ ë°ì´í„° êµ¬ì¡° ë¶„ì„...")
            
            # í˜„ì¬ í˜ì´ì§€ì˜ ì•„ì´í…œ êµ¬ì¡° ë¶„ì„
            html_content = page.content()
            soup = BeautifulSoup(html_content, 'html.parser')
            
            # Music ì•„ì´í…œë“¤ ë¶„ì„
            music_items = soup.select("div.ItemCard_soundItemContainer__GUmFb")
            print(f"\nğŸ“Š Music ì•„ì´í…œ ê°œìˆ˜: {len(music_items)}")
            
            if music_items:
                print("\nğŸ” Music ì•„ì´í…œ êµ¬ì¡° ë¶„ì„ (ì²« ë²ˆì§¸ ì•„ì´í…œ):")
                first_item = music_items[0]
                
                # ì œëª©
                title_tag = first_item.select_one("span.ItemCard_musicName__2znhM")
                if title_tag:
                    print(f"   ì œëª©: {title_tag.get_text().strip()}")
                
                # ì•„í‹°ìŠ¤íŠ¸
                artist_tag = first_item.select_one("span.ItemCard_autherName__gdrue")
                if artist_tag:
                    print(f"   ì•„í‹°ìŠ¤íŠ¸: {artist_tag.get_text().strip()}")
                
                # ìˆœìœ„
                rank_tag = first_item.select_one("span.RankingStatus_rankingIndex__ZMDrH")
                if rank_tag:
                    print(f"   ìˆœìœ„: {rank_tag.get_text().strip()}")
                
                # ì¸ë„¤ì¼/ì´ë¯¸ì§€
                img_tags = first_item.select("img")
                if img_tags:
                    print(f"   ì´ë¯¸ì§€ ê°œìˆ˜: {len(img_tags)}")
                    for i, img in enumerate(img_tags):
                        src = img.get('src', '')
                        alt = img.get('alt', '')
                        print(f"     ì´ë¯¸ì§€ {i+1}: {src[:50]}... (alt: {alt})")
                
                # ë§í¬ë“¤
                links = first_item.select("a")
                if links:
                    print(f"   ë§í¬ ê°œìˆ˜: {len(links)}")
                    for i, link in enumerate(links):
                        href = link.get('href', '')
                        print(f"     ë§í¬ {i+1}: {href}")
            
            # í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ì‹œë„ - Creative Center ë©”ì¸ ë©”ë‰´ ì°¾ê¸°
            print("\nğŸ§­ Creative Center ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ íƒìƒ‰...")
            
            # Creative Center ë©”ë‰´ë“¤ ì°¾ê¸°
            nav_selectors = [
                "nav a",
                "[role='navigation'] a",
                ".navigation a",
                "header a",
                "[data-testid*='nav']"
            ]
            
            for selector in nav_selectors:
                try:
                    nav_links = page.query_selector_all(selector)
                    if nav_links:
                        print(f"\nğŸ“ ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ë“¤ ({selector}):")
                        for i, link in enumerate(nav_links[:10]):  # ì²˜ìŒ 10ê°œë§Œ
                            try:
                                text = link.inner_text().strip()
                                href = link.get_attribute('href')
                                if text and ('video' in text.lower() or 'creator' in text.lower() or 'trend' in text.lower()):
                                    print(f"   ğŸ¯ {text}: {href}")
                            except:
                                continue
                        break
                except Exception as e:
                    continue
            
            # URL êµ¬ì¡° ë¶„ì„ - ë‹¤ë¥¸ ì„¹ì…˜ URL ì¶”ì¸¡
            print("\nğŸ”— URL íŒ¨í„´ ë¶„ì„:")
            current_url = page.url
            print(f"   í˜„ì¬ URL: {current_url}")
            
            # URLì—ì„œ 'music'ì„ ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ë°”ê¿”ì„œ ì‹œë„
            base_url = current_url.replace('/music/', '/')
            potential_urls = [
                current_url.replace('/music/', '/video/'),
                current_url.replace('/music/', '/creator/'),
                current_url.replace('/music/', '/ads/'),
                current_url.replace('/music/', '/content/'),
                "https://ads.tiktok.com/business/creativecenter/inspiration/popular/video/pc/en",
                "https://ads.tiktok.com/business/creativecenter/inspiration/popular/creator/pc/en"
            ]
            
            print("\nğŸ¯ ì‹œë„í•´ë³¼ URLë“¤:")
            for url in potential_urls:
                print(f"   - {url}")
            
            # ì‹¤ì œë¡œ Video URLì— ì ‘ì† ì‹œë„
            print("\nğŸš€ Video ì„¹ì…˜ URL ì ‘ì† ì‹œë„...")
            video_url = "https://ads.tiktok.com/business/creativecenter/inspiration/popular/video/pc/en"
            
            try:
                print(f"   ì´ë™ ì¤‘: {video_url}")
                page.goto(video_url, wait_until="networkidle")
                page.wait_for_timeout(5000)
                
                print("âœ… Video ì„¹ì…˜ ì ‘ì† ì„±ê³µ!")
                
                # Video ì„¹ì…˜ì˜ ë°ì´í„° êµ¬ì¡° ë¶„ì„
                print("\nğŸ¬ Video ì„¹ì…˜ ë°ì´í„° êµ¬ì¡° ë¶„ì„...")
                page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                page.wait_for_timeout(3000)
                
                html_content = page.content()
                soup = BeautifulSoup(html_content, 'html.parser')
                
                # Video ì•„ì´í…œë“¤ ì°¾ê¸° - ì—¬ëŸ¬ ê°€ëŠ¥í•œ ì…€ë ‰í„° ì‹œë„
                video_selectors = [
                    "div[class*='VideoItem']",
                    "div[class*='videoItem']", 
                    "div[class*='Video']",
                    "div[class*='ItemCard']",
                    "div[class*='ContentItem']",
                    "div[class*='item']",
                    "[data-testid*='video']"
                ]
                
                video_items = []
                used_selector = None
                
                for selector in video_selectors:
                    items = soup.select(selector)
                    if items and len(items) > 5:  # ì¶©ë¶„í•œ ì•„ì´í…œì´ ìˆëŠ” ì…€ë ‰í„°
                        video_items = items
                        used_selector = selector
                        break
                
                if video_items:
                    print(f"âœ… Video ì•„ì´í…œ ë°œê²¬! (ì…€ë ‰í„°: {used_selector})")
                    print(f"   ì•„ì´í…œ ê°œìˆ˜: {len(video_items)}")
                    
                    # ì²« ë²ˆì§¸ ë¹„ë””ì˜¤ ì•„ì´í…œ ìƒì„¸ ë¶„ì„
                    print(f"\nğŸ” ì²« ë²ˆì§¸ ë¹„ë””ì˜¤ ì•„ì´í…œ êµ¬ì¡°:")
                    first_video = video_items[0]
                    
                    # ì¸ë„¤ì¼ ì´ë¯¸ì§€
                    thumbnails = first_video.select("img")
                    print(f"   ì¸ë„¤ì¼ ê°œìˆ˜: {len(thumbnails)}")
                    for i, img in enumerate(thumbnails):
                        src = img.get('src', '')
                        alt = img.get('alt', '')
                        print(f"     ì¸ë„¤ì¼ {i+1}: {src[:60]}...")
                        print(f"                  Alt: {alt}")
                    
                    # ë¹„ë””ì˜¤ ë§í¬
                    video_links = first_video.select("a")
                    print(f"   ë§í¬ ê°œìˆ˜: {len(video_links)}")
                    for i, link in enumerate(video_links):
                        href = link.get('href', '')
                        if href:
                            print(f"     ë§í¬ {i+1}: {href}")
                    
                    # í…ìŠ¤íŠ¸ ì½˜í…ì¸  (í•´ì‹œíƒœê·¸ ë“±)
                    all_text = first_video.get_text()
                    if '#' in all_text:
                        print(f"   í•´ì‹œíƒœê·¸ í¬í•¨ ê°€ëŠ¥ì„±: âœ…")
                        # í•´ì‹œíƒœê·¸ ì¶”ì¶œ ì‹œë„
                        words = all_text.split()
                        hashtags = [word for word in words if word.startswith('#')]
                        if hashtags:
                            print(f"   ë°œê²¬ëœ í•´ì‹œíƒœê·¸: {hashtags[:5]}")
                    else:
                        print(f"   í•´ì‹œíƒœê·¸ í¬í•¨ ê°€ëŠ¥ì„±: âŒ")
                    
                    # ìˆœìœ„ ì •ë³´
                    rank_selectors = [
                        "span[class*='rank']",
                        "div[class*='rank']", 
                        "span[class*='index']",
                        "[class*='ranking']"
                    ]
                    
                    for rank_sel in rank_selectors:
                        rank_elem = first_video.select_one(rank_sel)
                        if rank_elem:
                            print(f"   ìˆœìœ„ ì •ë³´: {rank_elem.get_text().strip()}")
                            break
                    
                    # View More ë²„íŠ¼ í™•ì¸
                    print(f"\nğŸ”„ View More ë²„íŠ¼ íƒìƒ‰...")
                    view_more_selectors = [
                        "text=\"View More\"",
                        "button:has-text('View More')",
                        "[class*='view-more']",
                        "[class*='viewMore']"
                    ]
                    
                    view_more_found = False
                    for vm_selector in view_more_selectors:
                        try:
                            view_more = page.query_selector(vm_selector)
                            if view_more and view_more.is_visible():
                                print(f"   âœ… View More ë²„íŠ¼ ë°œê²¬: {vm_selector}")
                                view_more_found = True
                                break
                        except:
                            continue
                    
                    if not view_more_found:
                        print(f"   âŒ View More ë²„íŠ¼ ì—†ìŒ - ëª¨ë“  ì•„ì´í…œì´ ë¡œë“œë˜ì—ˆì„ ê°€ëŠ¥ì„±")
                    
                    # ìƒ˜í”Œ ë°ì´í„° ìˆ˜ì§‘ ì‹œì—°
                    print(f"\nğŸ“Š ìƒìœ„ 5ê°œ ë¹„ë””ì˜¤ ìƒ˜í”Œ ë°ì´í„°:")
                    for i, item in enumerate(video_items[:5]):
                        print(f"\n   ë¹„ë””ì˜¤ {i+1}:")
                        
                        # ì¸ë„¤ì¼
                        thumb = item.select_one("img")
                        if thumb:
                            thumb_src = thumb.get('src', '')
                            print(f"     ì¸ë„¤ì¼: {thumb_src[:50]}...")
                        
                        # ë§í¬
                        link = item.select_one("a")
                        if link:
                            href = link.get('href', '')
                            print(f"     ë¹„ë””ì˜¤ ë§í¬: {href}")
                        
                        # í…ìŠ¤íŠ¸ì—ì„œ í•´ì‹œíƒœê·¸ ì¶”ì¶œ
                        text = item.get_text()
                        hashtags = [word for word in text.split() if word.startswith('#')]
                        if hashtags:
                            print(f"     í•´ì‹œíƒœê·¸: {hashtags[:3]}")
                        
                else:
                    print("âŒ Video ì•„ì´í…œì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
                    print("   í˜ì´ì§€ ì†ŒìŠ¤ ì¼ë¶€:")
                    print(soup.get_text()[:200] + "...")
                
            except Exception as e:
                print(f"âŒ Video ì„¹ì…˜ ì ‘ì† ì‹¤íŒ¨: {e}")
            
            print("\nâ¸ï¸  ë¸Œë¼ìš°ì €ë¥¼ 10ì´ˆê°„ ì—´ì–´ë‘¡ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”...")
            page.wait_for_timeout(10000)
            
        except Exception as e:
            print(f"âŒ íƒìƒ‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        
        finally:
            browser.close()
    
    print("\nğŸ‰ TikTok Creative Center Video ì„¹ì…˜ íƒìƒ‰ ì™„ë£Œ!")

if __name__ == "__main__":
    explore_tiktok_videos()